<xml>

   <!-- LINUX TOOLS -->


   <section if="xcompile">
      <section if="HXCPP_M64">
         <set name="CXX" value="${HXCPP_XLINUX64_CXX}" />
         <set name="HXCPP_STRIP" value="${HXCPP_XLINUX64_STRIP}" />
         <set name="HXCPP_AR" value="${HXCPP_XLINUX64_AR}" />
         <set name="HXCPP_RANLIB" value="${HXCPP_XLINUX64_RANLIB}" />
      </section>
      <section unless="HXCPP_M64">
         <set name="CXX" value="${HXCPP_XLINUX32_CXX}" />
         <set name="HXCPP_STRIP" value="${HXCPP_XLINUX32_STRIP}" />
         <set name="HXCPP_AR" value="${HXCPP_XLINUX32_AR}" />
         <set name="HXCPP_RANLIB" value="${HXCPP_XLINUX32_RANLIB}" />
      </section>
      <section if="rpi">
         <path name="c:/SysGCC/Raspberry/bin/" unless="HXCPP_XCOMPILE_RPI_PATH" />
         <path name="${HXCPP_XCOMPILE_RPI_PATH}" if="HXCPP_XCOMPILE_RPI_PATH" />
         <set name="CXX" value="arm-linux-gnueabihf-g++" />
         <set name="HXCPP_STRIP" value="arm-linux-gnueabihf-strip" />
         <set name="HXCPP_AR" value="arm-linux-gnueabihf-ar" />
         <set name="HXCPP_RANLIB" value="arm-linux-gnueabihf-ranlib" />
      </section>

      <section if="nx">
         <!-- Nintendo 3DS DevKitA64 paths -->
         <path name="[DKP_PATH]/devkitARM/bin/" />
         <path name="[DKP_PATH]/tools/bin/" />
         <set name='CXX' value='arm-none-eabi-g++' />
         <set name='HXCPP_STRIP' value='arm-none-eabi-strip' />
         <set name='HXCPP_AR' value='arm-none-eabi-ar' />
         <set name='HXCPP_RANLIB' value='arm-none-eabi-ranlib' />
      </section>
      
   </section>

   <set name="HXCPP_CPP11" value="1" unless="HXCPP_NO_CPP11 || HXCPP_CPP17" />

   <include name="toolchain/gcc-toolchain.xml"/>
   <set name="noM32" value="1" if="HXCPP_NO_M32" />
   <set name="noM32" value="1" if="HXCPP_M64" />
   <set name="noM32" value="1" if="rpi" />
   <set name="noM32" value="1" if="HXCPP_ARM64" />
   <set name="noM64" value="1" if="HXCPP_ARM64" />

   <compiler id="linux" exe="g++" if="linux">
      <exe name="${CXX}" if="CXX" />
      <flag value="-c"/>
      <flag value="-fvisibility=hidden"/>
      <cppflag value="-frtti"/>
      <cppflag value="-std=c++11" if="HXCPP_CPP11" />
      <cppflag value="-std=c++17" if="HXCPP_CPP17"/>
      
      <!-- Nintendo 3DS specific flags -->
      <section if="nx">
         <flag value='-march=armv6k' />
         <flag value='-mtp=soft' />
         <flag value='-mtune=mpcore' />
         <flag value='-mfloat-abi=hard' />
         <flag value='-w' />
         <!-- <flag value='-Wreorder' />
         <flag value='-Wstrict-aliasing' />
         <flag value='-Winvalid-offsetof' />
         <flag value='-Wsign-compare' />
         <flag value='-Wunknown-pragmas' /> -->
         <flag value='-D__3DS__' />
         <flag value='-D__TM_GMTOFF=tm_gmtoff'/>
         <flag value='-D__POSIX_VISIBLE'/>
         <flag value='-D__BSD_VISIBLE'/>
         <flag value="-DHAXE3DS"/>
         
         <!-- HashLink flags -->
         <!-- <flag value="-DHL_CONSOLE"/>
         <flag value="-DHL_NX"/> -->
         
         <flag value='-I[DKP_PATH]/libctru/include'/>
         <flag value='-I[DKP_PATH]/portlibs/3ds/include'/>
         <flag value='-I[DKP_PATH]/portlibs/armv6k/include'/>
         
         [HAXE3DS_FLAGS]

         <flag value='-ffunction-sections' />
         <flag value='-fexceptions' />
         <flag value='-fpermissive' />
         <flag value='-static' />
      </section>

      <flag value="-fpic" unless="nx" />
      <flag value="-fPIC" unless="nx"/>

      <flag value="-Wno-overflow" />
      <cppflag value="-Wno-invalid-offsetof" />

      <flag value="-DHX_LINUX"/>
      <flag value="-DRASPBERRYPI=RASPBERRYPI" if="rpi"/>
      <flag value="-DHXCPP_MULTI_THREADED" if="HXCPP_MULTI_THREADED"/>
      <flag value="-DHXCPP_BIG_ENDIAN" if="HXCPP_BIG_ENDIAN"/>
      <include name="toolchain/common-defines.xml" />
      <flag value="-m32" unless="noM32"/>
      <flag value="-m64" if="HXCPP_M64" unless="noM64 || nx" />
      <flag value="-DHXCPP_M64" if="HXCPP_M64"/>
      <flag value="-I${HXCPP}/include"/>
      <objdir value="obj/linux${OBJEXT}/"/>
      <outflag value="-o"/>
      <ext value=".o"/>
   </compiler>

   <linker id="dll" exe="g++" if="linux">
      <exe name="${CXX}" if="CXX" />
      <fromfile value="" if="GCC_OLD" />
      <flag value="-shared"/>
      <flag value="-fpic"/>
      <flag value="-fPIC"/>
      <flag value="-m32" unless="noM32"/>
      <flag value="-m64" if="HXCPP_M64" unless="noM64 || nx" />
      <flag value="-Xlinker"/>
      <flag value="--no-undefined" unless="HXCPP_ALLOW_UNDEFINED" />
      <lib name="-ldl"/>

      <section if="nx">
         <flag value="-specs=3dsx.specs"/>
         <lib name="-L[DKP_PATH]/libctru/lib"/>
         <lib name="-L[DKP_PATH]/portlibs/3ds/lib"/>
         <lib name="-I[DKP_PATH]/portlibs/3ds/include"/>
      </section>

      <ext value=".dso"/>
      <outflag value="-o "/>
   </linker>

   <linker id="exe" exe="g++" if="linux">
      <exe name="${CXX}" if="CXX" />
      <fromfile value="" if="GCC_OLD" />
      <flag value="-rdynamic"/>
      <flag value="-m32" unless="noM32"/>
      <flag value="-m64" if="HXCPP_M64" unless="noM64 || nx" />
      <lib name="-ldl"/>
      <ext value=""/>
      <outflag value="-o "/>
   </linker>

</xml>
